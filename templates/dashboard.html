{% extends 'base.html' %}

{% block title %}Dashboard - FlowHub{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Welcome back!</h1>
        <p class="page-subtitle">Here's what's happening with your productivity today</p>
    </div>
    <div class="flex gap-3">
        <a href="{% url 'dashboard_enhanced' %}" class="btn btn-secondary">
            {% include "includes/heroicon.html" with icon_name="chart-bar" class="icon-sm" %}
            Task Dashboard
        </a>
        <a href="{% url 'task_create' %}" class="btn btn-primary">
            {% include "includes/heroicon.html" with icon_name="plus" class="icon-sm" %}
            New Task
        </a>
    </div>
</div>

<!-- Stats Overview -->
<div class="grid grid-4 mb-8">
    <div class="stat-card">
        <div class="stat-label">Total Tasks</div>
        <div class="stat-value">{{ tasks_total }}</div>
        <div class="stat-change positive">
            {% include "includes/heroicon.html" with icon_name="clock" class="icon-sm" %}
            {{ tasks_in_progress }} in progress
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Completed Today</div>
        <div class="stat-value">{{ tasks_completed }}</div>
        <div class="stat-change positive">
            {% include "includes/heroicon.html" with icon_name="check-circle" class="icon-sm" %}
            Great work!
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Pomodoro Sessions</div>
        <div class="stat-value">{{ pomodoro_today }}</div>
        <div class="stat-change {% if pomodoro_today >= 4 %}positive{% endif %}">
            {% include "includes/heroicon.html" with icon_name="clock" class="icon-sm" %}
            {{ pomodoro_today|floatformat:0 }} focused
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Monthly Balance</div>
        <div class="stat-value">${{ balance|floatformat:0 }}</div>
        <div class="stat-change {% if balance >= 0 %}positive{% else %}negative{% endif %}">
            {% include "includes/heroicon.html" with icon_name="currency-dollar" class="icon-sm" %}
            ${{ income|floatformat:0 }} income
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-2 gap-8">
    <!-- Left Column -->
    <div class="space-y-8">
        <!-- Today's Tasks -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    {% include "includes/heroicon.html" with icon_name="calendar" class="icon-md text-primary" %}
                    Today's Tasks
                </h2>
                <a href="{% url 'task_list' %}" class="text-sm font-semibold text-primary hover:underline">View all</a>
            </div>
            
            {% if tasks_today %}
            <div class="space-y-3">
                {% for task in tasks_today %}
                <div class="p-4 bg-bg-tertiary rounded-xl border-l-4 
                    {% if task.priority == 'high' %}border-danger
                    {% elif task.priority == 'medium' %}border-warning
                    {% else %}border-info{% endif %}">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold text-gray-100 mb-1">{{ task.title }}</h3>
                            <div class="flex items-center gap-2 text-xs text-gray-500">
                                {% if task.due_date %}
                                    <span class="flex items-center gap-1">
                                        {% include "includes/heroicon.html" with icon_name="clock" class="icon-sm" %}
                                        {{ task.due_date|date:"g:i A" }}
                                    </span>
                                {% endif %}
                                {% if task.task_list %}
                                    <span class="flex items-center gap-1">
                                        {% include "includes/heroicon.html" with icon_name="list-bullet" class="icon-sm" %}
                                        {{ task.task_list.name }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            {% include "tasks/partials/priority_icon.html" with priority=task.priority %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12 text-gray-500">
                {% include "includes/heroicon.html" with icon_name="sparkles" class="icon-xl mx-auto mb-4 opacity-20" %}
                <p class="font-semibold">No tasks due today</p>
                <p class="text-sm">Enjoy your free time!</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Habit Tracker -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    {% include "includes/heroicon.html" with icon_name="fire" class="icon-md text-orange-500" %}
                    Today's Habits
                </h2>
                <a href="{% url 'habit_list' %}" class="text-sm font-semibold text-primary hover:underline">View all</a>
            </div>
            
            {% if habits %}
            <div class="grid grid-2 gap-4">
                {% for habit in habits %}
                <div class="p-4 bg-bg-tertiary rounded-xl text-center border border-border hover:border-border-hover transition-colors">
                    <div class="text-3xl mb-2">{{ habit.icon }}</div>
                    <div class="font-semibold mb-3">{{ habit.name }}</div>
                    <div class="flex items-center justify-center gap-3">
                        {% if habit.id in today_completions %}
                        <div class="w-8 h-8 rounded-full bg-success flex items-center justify-center text-white">
                            {% include "includes/heroicon.html" with icon_name="check-circle" class="icon-sm" %}
                        </div>
                        {% else %}
                        <div class="w-8 h-8 rounded-full border-2 border-border hover:border-primary cursor-pointer transition-colors"></div>
                        {% endif %}
                        <span class="text-xs font-bold text-gray-500">
                            {{ habit.current_streak }}d streak
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-500">
                <p>No habits yet. Start a new one today!</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Right Column -->
    <div class="space-y-8">
        <!-- Daily Mood -->
        <div class="card">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                {% include "includes/heroicon.html" with icon_name="sparkles" class="icon-md text-accent" %}
                How are you feeling?
            </h2>
            
            <div class="flex justify-around mb-6">
                {% for mood, label in daily_entry.MOOD_CHOICES %}
                <button class="p-4 rounded-2xl transition-all hover:scale-110 
                    {% if daily_entry.mood == mood %}bg-primary/20 border-2 border-primary{% else %}bg-bg-tertiary border-2 border-transparent{% endif %}">
                    <span class="text-3xl">{{ label|slice:":2" }}</span>
                </button>
                {% endfor %}
            </div>
            
            <textarea placeholder="How's your day going? Write your thoughts..." 
                class="w-full p-4 bg-bg-tertiary border border-border rounded-xl text-white focus:outline-none focus:border-primary resize-none min-height-[120px]">{{ daily_entry.morning_notes }}</textarea>
        </div>
        
        <!-- Recent Notes -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    {% include "includes/heroicon.html" with icon_name="document-text" class="icon-md text-secondary" %}
                    Recent Notes
                </h2>
                <a href="{% url 'note_list' %}" class="text-sm font-semibold text-primary hover:underline">View all</a>
            </div>
            
            {% if recent_notes %}
            <div class="space-y-3">
                {% for note in recent_notes %}
                <a href="{% url 'note_detail' note.id %}" class="block p-4 bg-bg-tertiary rounded-xl border border-transparent hover:border-border-hover hover:bg-white/5 transition-all">
                    <div class="font-semibold mb-1 text-gray-100">{{ note.title }}</div>
                    <div class="text-sm text-gray-500 line-clamp-1 mb-2">
                        {{ note.content|truncatewords:10 }}
                    </div>
                    <div class="text-[10px] text-gray-600 font-bold uppercase tracking-wider">
                        Updated {{ note.updated_at|timesince }} ago
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-500">
                <p>No notes yet. Capture your ideas!</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Upcoming Reminders -->
        {% if upcoming_reminders %}
        <div class="card">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-warning">
                {% include "includes/heroicon.html" with icon_name="clock" class="icon-md" %}
                Upcoming Reminders
            </h2>
            <div class="space-y-3">
                {% for reminder in upcoming_reminders %}
                <div class="p-4 bg-bg-tertiary rounded-xl border border-warning/20">
                    <div class="font-semibold mb-1">{{ reminder.title }}</div>
                    <div class="text-xs text-warning flex items-center gap-1 font-bold">
                        {% include "includes/heroicon.html" with icon_name="clock" class="icon-sm" %}
                        {{ reminder.remind_at|date:"M d, g:i A" }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
