{% extends 'base.html' %}

{% block title %}Calendar View - FlowHub{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Calendar</h1>
        <p class="page-subtitle">{{ month_name }} {{ year }}</p>
    </div>
    <div class="flex gap-2">
        <a href="?view=list" class="btn btn-secondary">
            {% include "includes/heroicon.html" with icon_name="list-bullet" class="icon-sm" %}
            List
        </a>
        <a href="?view=kanban" class="btn btn-secondary">
            {% include "includes/heroicon.html" with icon_name="square-2-stack" class="icon-sm" %}
            Kanban
        </a>
        <a href="{% url 'task_calendar' %}" class="btn btn-secondary bg-primary/10 text-primary border-primary/50">
            {% include "includes/heroicon.html" with icon_name="calendar" class="icon-sm" %}
            Calendar
        </a>
        <a href="{% url 'task_create' %}" class="btn btn-primary">
            {% include "includes/heroicon.html" with icon_name="plus" class="icon-sm" %}
            New Task
        </a>
    </div>
</div>

<div class="card p-6">
    <div class="flex justify-between items-center mb-6">
        <div class="flex gap-2">
            <a href="?year={{ prev_year }}&month={{ prev_month }}" class="btn btn-secondary p-2">
                {% include "includes/heroicon.html" with icon_name="minus" class="icon-sm rotate-90" %}
            </a>
            <a href="?year={{ next_year }}&month={{ next_month }}" class="btn btn-secondary p-2">
                {% include "includes/heroicon.html" with icon_name="plus" class="icon-sm rotate-90" %}
            </a>
        </div>
        <h2 class="text-2xl font-bold">{{ month_name }} {{ year }}</h2>
        <a href="{% url 'task_calendar' %}" class="btn btn-secondary text-sm">Today</a>
    </div>
    
    <div class="calendar-grid">
        <div class="day-header">Mon</div>
        <div class="day-header">Tue</div>
        <div class="day-header">Wed</div>
        <div class="day-header">Thu</div>
        <div class="day-header">Fri</div>
        <div class="day-header">Sat</div>
        <div class="day-header">Sun</div>
        
        {% for week in calendar %}
            {% for day in week %}
                <div class="calendar-day {% if day == 0 %}empty{% endif %}">
                    {% if day != 0 %}
                        <div class="day-number">{{ day }}</div>
                        <div class="day-tasks">
                            {% for day_val, tasks in tasks_by_day.items %}
                                {% if day_val == day %}
                                    {% for task in tasks %}
                                        <a href="{% url 'task_detail' task.pk %}" class="mini-task priority-{{ task.priority }}" title="{{ task.title }}">
                                            {% include "tasks/partials/priority_icon.html" with priority=task.priority class="icon-[10px]" %}
                                            <span class="truncate">{{ task.title }}</span>
                                        </a>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endfor %}
    </div>
</div>

<style>
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
}

.day-header {
    background: var(--bg-tertiary);
    padding: 1rem;
    text-align: center;
    font-weight: 700;
    font-size: 0.8rem;
    text-transform: uppercase;
    color: var(--text-secondary);
}

.calendar-day {
    background: var(--bg-card);
    min-height: 120px;
    padding: 0.5rem;
    transition: background 0.2s;
}

.calendar-day:not(.empty):hover {
    background: rgba(255, 255, 255, 0.02);
}

.calendar-day.empty {
    background: rgba(0, 0, 0, 0.1);
}

.day-number {
    font-weight: 700;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
}

.day-tasks {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.mini-task {
    font-size: 0.7rem;
    padding: 0.2rem 0.4rem;
    background: var(--bg-tertiary);
    border-radius: 4px;
    display: flex;
    items-center;
    gap: 0.25rem;
    color: var(--text-primary);
    text-decoration: none;
    border-left: 2px solid transparent;
    transition: all 0.2s;
}

.mini-task:hover {
    background: var(--border);
    transform: translateX(2px);
}

.mini-task.priority-high { border-left-color: var(--danger); }
.mini-task.priority-medium { border-left-color: var(--warning); }
.mini-task.priority-low { border-left-color: var(--info); }

.rotate-90 { transform: rotate(-90deg); }
</style>
{% endblock %}
